###############################################################################
## MCP Transforms (from TA-mcp-jsonrpc)
###############################################################################

# Optional: Filter out notification messages if volume is too high
[setnull_notifications]
REGEX = "method"\s*:\s*"notifications/
DEST_KEY = queue
FORMAT = nullQueue

# Optional: Route different server types to different indexes
[route_to_mcp_filesystem]
SOURCE_KEY = MetaData:Sourcetype
REGEX = mcp:jsonrpc
DEST_KEY = _MetaData:Index
FORMAT = mcp

# Extract server type from filename
[extract_server_type]
SOURCE_KEY = source
REGEX = /([^/]+)\.jsonl$
FORMAT = server_type::$1
WRITE_META = true

###############################################################################
## Ollama Transforms (from TA-ollama)
###############################################################################

# Redaction pipeline for prompts/responses (basic content masking)
[ollama_redact_prompts]
REGEX = ("(prompt|response|content)"\s*:\s*")(.*?)(")
FORMAT = "$1[REDACTED]$3"
DEST_KEY = _raw

# Extract web fields from GIN logs (legacy - kept for backwards compatibility)
[ollama_web_extraction]
REGEX = \[GIN\]\s+[^|]+\|\s+(\d+)\s+\|\s+([^\|]+?)\s+\|\s+([^\|]+?)\s+\|\s+(\w+)\s+"([^"]+)"
FORMAT = status::$1 response_time::$2 src::$3 http_method::$4 uri_path::$5 http_response_code::$1

# Extract fields from timestamp-based structured logs (new Ollama format)
# Format: time=2024-01-21T10:30:00.123456Z level=info msg="..." source=server.go:123
[ollama_timestamp_extraction]
REGEX = time=(\S+)\s+level=(\w+)\s+(?:msg="([^"]*)")?\s*(?:source=(\S+))?(?:.*status=(\d+))?(?:.*method=(\w+))?(?:.*path="?([^"\s]+)"?)?(?:.*duration=([^\s]+))?(?:.*ip=([^\s]+))?
FORMAT = timestamp::$1 log_level::$2 log_msg::$3 code_source::$4 status::$5 http_method::$6 uri_path::$7 response_time::$8 src::$9 http_response_code::$5
